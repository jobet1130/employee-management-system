# Payroll API Documentation

components:
  schemas:
    PayrollAdjustment:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Unique identifier for the adjustment
        payrollId:
          type: integer
          format: int64
          description: ID of the payroll record this adjustment belongs to
        type:
          type: string
          enum: [BONUS, COMMISSION, ALLOWANCE, REIMBURSEMENT, LOAN, ADVANCE, TAX, INSURANCE, PENSION, OTHER]
          description: Type of adjustment
        amount:
          type: number
          format: float
          description: Adjustment amount (positive for additions, negative for deductions)
        description:
          type: string
          description: Description of the adjustment
        approved:
          type: boolean
          description: Whether the adjustment has been approved
        approvedBy:
          type: integer
          format: int64
          nullable: true
          description: ID of the user who approved this adjustment
        approvedAt:
          type: string
          format: date-time
          nullable: true
          description: When the adjustment was approved
        createdAt:
          type: string
          format: date-time
          description: When the adjustment was created
        updatedAt:
          type: string
          format: date-time
          description: When the adjustment was last updated
        deletedAt:
          type: string
          format: date-time
          nullable: true
          description: When the adjustment was soft-deleted

    CreatePayrollAdjustmentRequest:
      type: object
      required: [payrollId, type, amount]
      properties:
        payrollId:
          type: integer
          format: int64
          description: ID of the payroll record
        type:
          type: string
          enum: [BONUS, COMMISSION, ALLOWANCE, REIMBURSEMENT, LOAN, ADVANCE, TAX, INSURANCE, PENSION, OTHER]
          description: Type of adjustment
        amount:
          type: number
          format: float
          description: Adjustment amount (positive for additions, negative for deductions)
        description:
          type: string
          description: Description of the adjustment
        approved:
          type: boolean
          default: false
          description: Whether the adjustment is pre-approved
        approvedBy:
          type: integer
          format: int64
          nullable: true
          description: ID of the user approving this adjustment

    UpdatePayrollAdjustmentRequest:
      type: object
      properties:
        type:
          type: string
          enum: [BONUS, COMMISSION, ALLOWANCE, REIMBURSEMENT, LOAN, ADVANCE, TAX, INSURANCE, PENSION, OTHER]
          description: Type of adjustment
        amount:
          type: number
          format: float
          description: Adjustment amount (positive for additions, negative for deductions)
        description:
          type: string
          description: Description of the adjustment
        approved:
          type: boolean
          description: Whether the adjustment is approved
        approvedBy:
          type: integer
          format: int64
          nullable: true
          description: ID of the user approving this adjustment

paths:
  /api/payroll:
    get:
      tags: [Payroll]
      summary: Get payroll records
      description: Returns a filtered list of payroll records
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/limit'
        - name: employeeId
          in: query
          schema:
            type: string
        - name: month
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 12
        - name: year
          in: query
          schema:
            type: integer
            minimum: 2000
            maximum: 2100
        - name: status
          in: query
          schema:
            type: string
            enum: [PENDING, PAID, CANCELLED]
      responses:
        '200':
          description: A paginated list of payroll records
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Payroll'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags: [Payroll]
      summary: Generate payroll
      description: Generates payroll for the specified period and employees
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [month, year]
              properties:
                month:
                  type: integer
                  minimum: 1
                  maximum: 12
                  description: 'Month (1-12)'
                year:
                  type: integer
                  minimum: 2000
                  maximum: 2100
                  description: 'Year (e.g., 2023)'
                employeeIds:
                  type: array
                  items:
                    type: string
                  description: 'List of employee IDs to generate payroll for. If not provided, generates for all active employees.'
                includeBonus:
                  type: boolean
                  default: false
                  description: 'Whether to include bonus in payroll calculation'
                includeDeductions:
                  type: boolean
                  default: true
                  description: 'Whether to include deductions in payroll calculation'
      responses:
        '201':
          description: Payroll generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Payroll'
                  message:
                    type: string
                    example: "Payroll generated successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/payroll/{id}:
    parameters:
      - $ref: '#/components/parameters/payrollId'
    
    get:
      tags: [Payroll]
      summary: Get payroll record by ID
      description: Returns a single payroll record by its ID
      responses:
        '200':
          description: Payroll record details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PayrollResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Payroll]
      summary: Update a payroll record
      description: Updates an existing payroll record
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Payroll'
      responses:
        '200':
          description: Payroll record updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PayrollResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Not authorized to update payroll records
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Payroll]
      summary: Delete a payroll record
      description: Deletes a payroll record by its ID
      responses:
        '200':
          description: Payroll record deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payroll record deleted successfully"
        '400':
          description: Cannot delete a processed payroll record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Not authorized to delete payroll records
        '404':
          $ref: '#/components/responses/NotFound'

  /api/payroll/{id}/process:
    parameters:
      - $ref: '#/components/parameters/payrollId'
    
    post:
      tags: [Payroll]
      summary: Process payroll
      description: Marks a payroll as processed/paid
      responses:
        '200':
          description: Payroll processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PayrollResponse'
        '400':
          description: Payroll is already processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Not authorized to process payroll
        '404':
          $ref: '#/components/responses/NotFound'
